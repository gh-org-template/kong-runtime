scms:
  openssl-latest:
    kind: "github"
    spec:
      user: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'
      email: "chutchic@gmail.com"
      owner: "gh-org-template"
      repository: "kong-runtime"
      token: '{{ requiredEnv "UPDATECLI_GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'
      branch: "main"

sources:
  openssl-latest:
    name: Get latest release
    kind: githubrelease
    spec:
      owner: gh-org-template
      repository: kong-openssl
      token: '{{ requiredEnv "UPDATECLI_GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "UPDATECLI_GITHUB_ACTOR" }}'

conditions:
  openssl-latest:
    name: Make sure the image has been published
    kind: dockerimage
    sourceid: openssl-latest
    spec:
      image: "ghcr.io/gh-org-template/kong-openssl"

targets:
  openssl-latest:
    name: "Update base image"
    sourceid: openssl-latest
    kind: dockerfile
    spec:
      files:
        - Dockerfile
      instruction:
        keyword: "ARG"
        matcher: "VERSION"
    conditions:
      - openssl-latest
